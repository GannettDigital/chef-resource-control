Resource Control
================

Resource Control is a chef cookbook for managing Solaris projects, tasks and resource
limits using the Resource Control Facility.

* http://docs.oracle.com/cd/E19683-01/817-1592/rmctrls-1/index.html

## Provides

Providers:
* project

Recipes:
* default - does nothing

## Requirements

* Solaris or Illumos-based operating system
* Tested on SmartOS

## Providers

### Project

#### Attributes

* project_limits
* task_limits
* process_limits
* comment

#### Actions

* `:create` - default
* `:nothing`

#### Overview

```ruby
resource_control_project "postgres" do
  comment "PostgreSQL 9.2"

  project_limits "max-shm-memory" => 12000000,
                 "max-lwps"       => 6
  task_limits    "max-cpu-time"   => 3600
  process_limits "max-cpu-time" => 3600
  action :create
end
```

See the documentation of resource controls in the References section below for available
resource limits.

#### Local actions and signalling

By default limits will not be enforced (local action set to `none`). This may seem
counter-intuitive, but can be useful for monitoring purposes when overages are logged
to syslog.

The local action can be set to either `deny` or `signal` through the following syntax:

```ruby
resource_control_project "redis" do
  process_limits "max-cpu-time" => {
          "value" => 3600,
          "deny"  => true
      }
end
```

```ruby
resource_control_project "sidekiq" do
  process_limits "max-cpu-time" => {
          "value" => 7200,
          "signal"  => "SIGTERM"
      }
end
```

Available signals are:

* SIGABRT - Terminate the process
* SIGHUP - Send a hangup signal. Occurs when carrier drops on an open line. Signal sent to the process group that controls the terminal.
* SIGTERM - Terminate the process. Termination signal sent by software.
* SIGKILL - Terminate the process and kill the program
* SIGSTOP - Stop the process. Job control signal.
* SIGXRES - Resource control limit exceeded. Generated by resource control facility.
* SIGXFSZ - Terminate the process. File size limit exceeded.
* SIGXCPU - Terminate the process. CPU time limit exceeded.

Note that not all signals can be sent for any resource limit. Please read the documentation
and man pages on resource controls for more information.

#### Privilege level

By default, the limits set by the project provider can only be modified by superusers. Assuming
that the chef run is executed by root, this should never need to be changed.

## References

* http://docs.oracle.com/cd/E19683-01/817-1592/rmctrls-1/index.html
* `man rctladm`
* `man prctl`
* `man resource_controls`
